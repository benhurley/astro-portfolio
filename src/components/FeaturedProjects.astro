---
import { Card, Heading, Link } from 'accessible-astro-components'
import { Icon } from 'astro-icon/components'
import { getCollection } from 'astro:content'
import CardWrapper from './CardWrapper.astro'

/**
 * FeaturedProjects Component
 *
 * @description A component that displays featured projects from Astro Content Collections
 */
interface Props {
  /**
   * Additional classes to apply to the section
   */
  class?: string
  /**
   * The number of projects to display
   * @default 3
   */
  limit?: number
  /**
   * The title for the section
   * @default "Projects"
   */
  title?: string
}

const { class: className, limit = 3, title = 'Highlights' } = Astro.props

// Get projects from content collection
const projects = await getCollection('projects')

// Dynamically import all images from the projects folder
const images = import.meta.glob('/src/assets/images/projects/*.{png,jpg,jpeg,webp}', { eager: true })

// Filter featured projects and sort them
const featuredProjects = projects
  .filter((project) => project.data.isFeatured)
  .sort((a, b) => a.data.sortOrder - b.data.sortOrder)
  .slice(0, limit)
  .map((project) => {
    // Get the image based on the featuredImage field from frontmatter
    const imagePath = `/src/assets/images/projects/${project.data.featuredImage}`
    const imageModule = images[imagePath]

    return {
      ...project,
      imageComponent: imageModule?.default
    }
  })
---

<section class:list={[className, 'my-16']}>
  <div class="container">
    <Heading level="h2" class="mb-6">{title}</Heading>
    <div class="grid grid-cols-1 gap-12 md:grid-cols-2 lg:grid-cols-3">
      {
        featuredProjects.map((project) => (
          <CardWrapper>
            <Card
              imageComponent={project.imageComponent}
              url={'/portfolio/' + project.id.replace(/\.mdx?$/, '')}
              headingLevel="h2"
              title={project.data.title}
              footer={'Made with ' + project.data.platform}
            >
              {project.data.description}
            </Card>
          </CardWrapper>
        ))
      }
    </div>
    <!-- <div class="mt-12">
      <Link href="/portfolio/" isButton animateOnHover animationType="nudge">
        View all projects
        <Icon aria-hidden="true" name="lucide:arrow-right" size="1.5rem" />
      </Link>
    </div> -->
  </div>
</section>
